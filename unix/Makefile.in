#
# This file is a Makefile for tDOM.  If it has the name
# "Makefile.in" then it is a template for a Makefile; to generate
# the actual Makefile, run "./configure", which is a configuration
# script generated by the "autoconf" program (constructs like
# "@foo@" will get replaced in the actual Makefile.
#
# RCS: $Id$


MAJOR_VERSION = @MAJOR_VERSION@
MINOR_VERSION = @MINOR_VERSION@
RELEASE_LEVEL = @RELEASE_LEVEL@
VERSION = @VERSION@

#----------------------------------------------------------------
# Things you can change to personalize the Makefile for your own
# site (you can make these changes in either Makefile.in or
# Makefile, but changes to Makefile will get lost if you re-run
# the configuration script).
#----------------------------------------------------------------

# Default top-level directories in which to install architecture-
# specific files (exec_prefix) and machine-independent files such
# as scripts (prefix).  The values specified here may be overridden
# at configure-time with the --exec-prefix and --prefix options
# to the "configure" script.

prefix =	@prefix@
exec_prefix =	@exec_prefix@

# The following definition can be set to non-null for special systems
# like AFS with replication.  It allows the pathnames used for installation
# to be different than those used for actually reference files at
# run-time.  INSTALL_ROOT is prepended to $prefix and $exec_prefix
# when installing files.
INSTALL_ROOT =

# Directory from which applications will reference the library of
# [incr Tcl] scripts (note: you can set the TDOM_LIBRARY environment
# variable at run-time to override this value):
TDOM_LIBRARY = $(prefix)/lib/tdom$(VERSION)

# Path name to use when installing library scripts:
SCRIPT_INSTALL_DIR =	$(INSTALL_ROOT)$(TDOM_LIBRARY)

# Directory in which to install the archive libtcl.a:
LIB_INSTALL_DIR =	$(INSTALL_ROOT)$(exec_prefix)/lib

# Path to use at runtime to refer to LIB_INSTALL_DIR:
LIB_RUNTIME_DIR =	$(exec_prefix)/lib

# Directory in which to install the program tclsh:
BIN_INSTALL_DIR =	$(INSTALL_ROOT)$(exec_prefix)/bin

# Directory in which to install the include file dom.h:
INCLUDE_INSTALL_DIR =	$(INSTALL_ROOT)$(prefix)/include

# Top-level directory in which to install manual entries:
MAN_INSTALL_DIR =	$(INSTALL_ROOT)$(prefix)/man

# Directory in which to install manual entry for tcldomsh:
MAN1_INSTALL_DIR =	$(MAN_INSTALL_DIR)/man1

# Directory in which to install manual entries for [incr Tcl]'s
# C library procedures:
MAN3_INSTALL_DIR =	$(MAN_INSTALL_DIR)/man3

# Directory in which to install manual entries for the built-in
# [incr Tcl] commands:
MANN_INSTALL_DIR =	$(MAN_INSTALL_DIR)/mann

# Tcl source directory is included in this distribution. Use this to
# get the correct path:
TCL_SRC_DIR = @TCL_SRC_DIR@

# The directory containing the Tcl library archive file appropriate
# for this version of Tk:
TCL_LIB_DIR =	@TCL_LIB_DIR@

# Library flags for Tcl library
TCL_LIB_FLAG =	@TCL_LIB_FLAG@

TCL_DBGX     =  @TCL_DBGX@

# Additional libraries to use when linking.  The "LIBS" part will be
# replaced (or has already been replaced) with relevant libraries as
# determined by the configure script.
#LIBS = @TCL_LIB_SPEC@ @TCL_LIBS@ @DL_LIBS@ -lc
LIBS = @TCL_LIB_SPEC@ @TCL_LIBS@  -lc

# To change the compiler switches, for example to change from -O
# to -g, change the following line:
# CFLAGS = @CFLAGS@  @SHLIB_CFLAGS@  @ANSI_C_FLAGS@ -DXML_NS -DXML_DTD
#
# for a smaller tDOM: 
# CFLAGS = @CFLAGS@ -DTDOM_NO_EXPAT -DTDOM_NO_UNKNOWN_CMD

CFLAGS = @CFLAGS@ -DXML_NS -DXML_DTD -DTDOM_NO_UNKNOWN_CMD


LDGFLAGS = @LDFLAGS_DEFAULT@

INCLUDES = @TCL_INCLUDES@

# To disable ANSI-C procedure prototypes reverse the comment characters
# on the following lines:
PROTO_FLAGS =
#PROTO_FLAGS = -DNO_PROTOTYPE

# To enable memory debugging reverse the comment characters on the following
# lines.  Warning:  if you enable memory debugging, you must do it
# *everywhere*, including all the code that calls Tcl, and you must use
# ckalloc and ckfree everywhere instead of malloc and free.
MEM_DEBUG_FLAGS =
#MEM_DEBUG_FLAGS = -DTCL_MEM_DEBUG

# Some versions of make, like SGI's, use the following variable to
# determine which shell to use for executing commands:
SHELL =		/bin/sh

# Tcl used to let the configure script choose which program to use
# for installing, but there are just too many different versions of
# "install" around;  better to use the install-sh script that comes
# with the distribution, which is slower but guaranteed to work.

INSTALL =               @srcdir@/install-sh -c  
INSTALL_PROGRAM =       ${INSTALL} 
INSTALL_SHLIB =         ${INSTALL} -m 555
INSTALL_DATA =          ${INSTALL} -m 644
MKINSTALLDIRS =         $(TOP_DIR)/../config/mkinstalldirs

# The symbols below provide support for dynamic loading and shared
# libraries.  The values of the symbols are normally set by the
# configure script.  You shouldn't normally need to modify any of
# these definitions by hand.

SHLIB_CFLAGS = @SHLIB_CFLAGS@

LD_SEARCH_FLAGS = @LD_SEARCH_FLAGS@

TDOM_LIB_FILE = @TDOM_LIB_FILE@
TDOM_SHLIB_FILE = @TDOM_SHLIB_FILE@


# The symbol below provides support for dynamic loading and shared
# libraries.  See configure.in for a description of what it means.
# The values of the symbolis normally set by the configure script.

SHLIB_LD = @SHLIB_LD@

#----------------------------------------------------------------
# The information below is modified by the configure script when
# Makefile is generated from Makefile.in.  You shouldn't normally
# modify any of this stuff by hand.
#----------------------------------------------------------------

OBJEXT =                @OBJEXT@
AC_FLAGS =		@TCL_DEFS@
STLIB_LD =              @STLIB_LD@       
RANLIB =		@RANLIB@
TOP_DIR =		@TDOM_SRC_DIR@
GENERIC_DIR = 		$(TOP_DIR)/generic

EXPAT_DIR = 		$(TOP_DIR)/expat-1.95.1
EXPAT_GENNM_DIR = 	$(TOP_DIR)/expat/gennmtab
EXPAT_PARSE_DIR = 	$(TOP_DIR)/expat/xmlparse
EXPAT_TOK_DIR =         $(TOP_DIR)/expat/xmltok
UNIX_DIR = 		$(TOP_DIR)/unix

#----------------------------------------------------------------
# The information below should be usable as is.  The configure
# script won't modify it and you shouldn't need to modify it
# either.
#----------------------------------------------------------------

CC = @CC@
CC_SWITCHES = $(CFLAGS) $(SHLIB_CFLAGS) -I$(UNIX_DIR)    \
-I$(GENERIC_DIR) -I$(EXPAT_DIR)                          \
$(INCLUDES) $(AC_FLAGS) $(PROTO_FLAGS)                   \
$(MEM_DEBUG_FLAGS) -DTDOM_VERSION=$(VERSION) \
-DVERSION=\"1.95.1\"


SOURCES_EXPAT = $(EXPAT_DIR)/xmlrole.c  \
                $(EXPAT_DIR)/xmltok.c   \
                $(EXPAT_DIR)/xmlparse.c \
                $(GENERIC_DIR)/tclexpat.c

SOURCES = $(GENERIC_DIR)/xmlsimple.c    \
          $(GENERIC_DIR)/utf8conv.c     \
          $(GENERIC_DIR)/dom.c          \
          $(GENERIC_DIR)/domalloc.c     \
          $(GENERIC_DIR)/domhtml.c      \
          $(GENERIC_DIR)/domxpath.c     \
          $(GENERIC_DIR)/domxslt.c      \
          $(GENERIC_DIR)/domlock.c      \
          $(GENERIC_DIR)/tcldom.c       \
          $(GENERIC_DIR)/nodecmd.c      \
          $(GENERIC_DIR)/tdominit.c     \
          $(GENERIC_DIR)/tclAppInit.c   \
          $(SOURCES_EXPAT)


OBJECTS_EXPAT =  xmltok.$(OBJEXT) xmlrole.$(OBJEXT) xmlparse.$(OBJEXT) \
                 tclexpat.$(OBJEXT) 	

OBJECTS_TDOM =  xmlsimple.$(OBJEXT) \
                utf8conv.$(OBJEXT)  \
                dom.$(OBJEXT)       \
                domalloc.$(OBJEXT)  \
                domhtml.$(OBJEXT)   \
                domxpath.$(OBJEXT)  \
                domxslt.$(OBJEXT)   \
                domlock.$(OBJEXT)   \
                tcldom.$(OBJEXT)    \
                nodecmd.$(OBJEXT)   \
                tdominit.$(OBJEXT) 

OBJECTS =  $(OBJECTS_EXPAT) $(OBJECTS_TDOM)

#------------------------------------------------------------------
#   For a tDOM version without Expat uncomment the following line
#
#------------------------------------------------------------------
# OBJECTS =  $(OBJECTS_TDOM)

$(TDOM_LIB_FILE)_OBJECTS = $(OBJECTS)

all: $(TDOM_SHLIB_FILE) tcldomsh
lib: $(TDOM_LIB_FILE) $(TDOM_SHLIB_FILE)

$(TDOM_SHLIB_FILE):  $(OBJECTS)
	${SHLIB_LD} $(OBJECTS) -o $(TDOM_SHLIB_FILE) @SHLIB_LD_LIBS@

$(TDOM_LIB_FILE):  $(OBJECTS)
	rm -f $(TDOM_LIB_FILE)
	$(STLIB_LD) $@ $(OBJECTS)
	$(RANLIB) $(TDOM_LIB_FILE) 

tcldomsh: tclAppInit.$(OBJEXT)  $(OBJECTS)
	$(CC) @LDFLAGS@ tclAppInit.$(OBJEXT) $(OBJECTS) \
		$(LIBS) $(LD_SEARCH_FLAGS) -o tcldomsh

test: tcldomsh
	LD_LIBRARY_PATH="$(TCL_LIB_DIR):`pwd`:$(LD_LIBRARY_PATH)"; \
	export LD_LIBRARY_PATH; \
	TCL_LIBRARY="$(TCL_SRC_DIR)/library"; export TCL_LIBRARY; \
	TDOM_LIBRARY=$(TOP_DIR)/library; export TDOM_LIBRARY; \
	TCLLIBPATH=$(TOP_DIR)/unix; export TCLLIBPATH; \
	( echo cd $(TOP_DIR)/tests\; source all ) | ./tcldomsh

install: install-libraries

install-libraries: $(TDOM_SHLIB_FILE)
	@for i in $(SCRIPT_INSTALL_DIR); \
	    do \
	    if [ ! -d $$i ] ; then \
	        echo "Making directory $$i"; \
	        mkdir -p $$i; \
	        chmod 755 $$i; \
	        else true; \
	    fi; \
	done;
	@for i in $(TOP_DIR)/lib/*.tcl; \
	    do \
	    echo "Installing $$i"; \
	    $(INSTALL_DATA) $$i $(SCRIPT_INSTALL_DIR); \
	done;
	@echo "Installing pkgIndex.tcl"
	@$(INSTALL_DATA) pkgIndex.tcl $(SCRIPT_INSTALL_DIR)
	@echo "Installing $(TDOM_SHLIB_FILE)"
	@$(INSTALL_SHLIB)  $(TDOM_SHLIB_FILE) $(SCRIPT_INSTALL_DIR)


install-static-library: $(TDOM_LIB_FILE)
	@$(INSTALL_SHLIB)  $(TDOM_LIB_FILE) $(LIB_INSTALL_DIR)

                                                                 
Makefile: $(UNIX_DIR)/Makefile.in
	# $(SHELL) config.status

clean:
	rm -f *.a *.$(OBJEXT) core errs *~ \#* TAGS *.E a.out errors \
	#rm -f gennmtab nametab.h tcldomsh* $(TDOM_LIB_FILE) $(TDOM_SHLIB_FILE)
	rm -f tcldomsh* $(TDOM_LIB_FILE) $(TDOM_SHLIB_FILE)
	rm -f *_pure_* *% ../tests/core

distclean: clean
	rm -f Makefile config.status config.cache config.log
	rm -f pkgIndex.tcl

pure: tclAppInit.$(OBJEXT) $(TDOM_LIB_FILE)
	purify $(CC) @LDFLAGS@ tclAppInit.$(OBJEXT) @TDOM_BUILD_LIB_SPEC@ \
		$(LIBS) $(LD_SEARCH_FLAGS) -o tcldomsh.pure

profile: tclAppInit.$(OBJEXT) $(TDOM_LIB_FILE)
	quantify $(CC) @LDFLAGS@ tclAppInit.$(OBJEXT) @TDOM_BUILD_LIB_SPEC@ \
		$(LIBS) $(LD_SEARCH_FLAGS) -o tcldomsh.pure

depend:
	makedepend -- $(CC_SWITCHES) -- $(SOURCES)

configure: configure.in
	autoconf

.c.$(OBJEXT):
	$(CC) -c $(CC_SWITCHES) $<


tclAppInit.$(OBJEXT): $(UNIX_DIR)/tclAppInit.c
	$(CC) -c $(CC_SWITCHES) $(UNIX_DIR)/tclAppInit.c

#nametab.h: gennmtab
#	rm -f $@
#	./gennmtab >$@
#
#
#gennmtab: $(EXPAT_GENNM_DIR)/gennmtab.c
#	$(CC) $(CC_SWITCHES) @LDFLAGS@ $(EXPAT_GENNM_DIR)/gennmtab.c \
#		$(LIBS) $(LD_SEARCH_FLAGS) -o gennmtab

xmlrole.$(OBJEXT): $(EXPAT_DIR)/xmlrole.c
	$(CC) -c $(CC_SWITCHES) $(EXPAT_DIR)/xmlrole.c

xmltok.$(OBJEXT): $(EXPAT_DIR)/xmltok.c 
	$(CC) -c $(CC_SWITCHES) $(EXPAT_DIR)/xmltok.c

#hashtable.$(OBJEXT): $(EXPAT_DIR)/hashtable.c
#	$(CC) -c $(CC_SWITCHES) $(EXPAT_DIR)/hashtable.c

xmlparse.$(OBJEXT): $(EXPAT_DIR)/xmlparse.c
	$(CC) -c $(CC_SWITCHES) $(EXPAT_DIR)/xmlparse.c


utf8conv.$(OBJEXT): $(GENERIC_DIR)/utf8conv.c $(GENERIC_DIR)/encodings.inc
	$(CC) -c $(CC_SWITCHES) $(GENERIC_DIR)/utf8conv.c

xmlsimple.$(OBJEXT): $(GENERIC_DIR)/xmlsimple.c $(GENERIC_DIR)/dom.h $(GENERIC_DIR)/domalloc.h 
	$(CC) -c $(CC_SWITCHES) $(GENERIC_DIR)/xmlsimple.c

domhtml.$(OBJEXT): $(GENERIC_DIR)/domhtml.c $(GENERIC_DIR)/dom.h $(GENERIC_DIR)/domalloc.h 
	$(CC) -c $(CC_SWITCHES) $(GENERIC_DIR)/domhtml.c

domalloc.$(OBJEXT): $(GENERIC_DIR)/domalloc.c $(GENERIC_DIR)/domalloc.h
	$(CC) -c $(CC_SWITCHES) $(GENERIC_DIR)/domalloc.c

dom.$(OBJEXT): $(GENERIC_DIR)/dom.c $(GENERIC_DIR)/dom.h $(GENERIC_DIR)/domalloc.h $(GENERIC_DIR)/utf8conv.h
	$(CC) -c $(CC_SWITCHES) $(GENERIC_DIR)/dom.c

domxpath.$(OBJEXT): $(GENERIC_DIR)/domxpath.c $(GENERIC_DIR)/dom.h $(GENERIC_DIR)/domxpath.h
	$(CC) -c $(CC_SWITCHES) $(GENERIC_DIR)/domxpath.c

domxslt.$(OBJEXT): $(GENERIC_DIR)/domxslt.c $(GENERIC_DIR)/dom.h $(GENERIC_DIR)/domxpath.h $(GENERIC_DIR)/domxslt.h
	$(CC) -c $(CC_SWITCHES) $(GENERIC_DIR)/domxslt.c

domlock.$(OBJEXT): $(GENERIC_DIR)/domlock.c $(GENERIC_DIR)/dom.h
	$(CC) -c $(CC_SWITCHES) $(GENERIC_DIR)/domlock.c

tclexpat.$(OBJEXT): $(GENERIC_DIR)/tclexpat.c
	$(CC) -c $(CC_SWITCHES) $(GENERIC_DIR)/tclexpat.c

tcldom.$(OBJEXT): $(GENERIC_DIR)/tcldom.c $(GENERIC_DIR)/dom.h $(GENERIC_DIR)/tcldom.h $(GENERIC_DIR)/domxpath.h $(GENERIC_DIR)/domxslt.h $(GENERIC_DIR)/xmlsimple.h $(GENERIC_DIR)/domhtml.h $(GENERIC_DIR)/nodecmd.h
	$(CC) -c $(CC_SWITCHES) $(GENERIC_DIR)/tcldom.c

nodecmd.$(OBJEXT): $(GENERIC_DIR)/nodecmd.c $(GENERIC_DIR)/dom.h $(GENERIC_DIR)/nodecmd.h
	$(CC) -c $(CC_SWITCHES) $(GENERIC_DIR)/nodecmd.c

tdominit.$(OBJEXT): $(GENERIC_DIR)/tdominit.c
	$(CC) -c $(CC_SWITCHES) $(GENERIC_DIR)/tdominit.c


# DO NOT DELETE THIS LINE -- make depend depends on it.

